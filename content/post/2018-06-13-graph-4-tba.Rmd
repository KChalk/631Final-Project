---
title: 'Graph 4: PCA Correlations '
author: ''
date: '2018-06-13'
slug: graph-4-tba
categories: []
tags: []
description: Desc
hacker_news_id: ''
lobsters_id: ''
meta_img: /images/image.jpg
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) 
library(ggplot2)
#library(ggalt)
library(ggradar)
library(extrafont)
library(ggfortify)
library(infer)
library(forcats)
library(ggridges)
library(here)
library(scales)
library(reshape2)

library(viridis)
library(shiny)
```


```{r}
covariances <- read_csv(here('static','data','redditProject','subset_covariance.csv'))
covlong <- gather(covariances, key=newDimension, value=covariance, -X1)

ggplot(covlong, aes(x=newDimension, y=X1, fill=covariance))+
  geom_tile()+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))

```

```{r}
nfreqs <- read_csv(here('static','data','redditProject','normal_subset_freqs.csv'))
redfreqs <- read_csv(here('static','data','redditProject','reduced_normal_subset_freqs'))

od_num=65
pc_num=21

correlations <- cor(nfreqs[c(2:(od_num+1))],redfreqs[c(2:(pc_num+1))])

corlong <- melt(correlations ) %>% 
   setNames(c('orig', 'red_dim', 'correlation'))


ggplot(corlong, aes(x=red_dim, y=orig, fill=correlation))+
  geom_tile()+ 
  theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  scale_fill_distiller(palette = "PRGn")
  #scale_fill_viridis(option='E')

```



```{r}
corlong <- corlong %>% 
  mutate(dictcat=case_when(
           orig %in% c('ifreq','wefreq','ipronfreq','theyfreq','youfreq','shehefreq','pronounfreq','ppronfreq')
           ~ 'pronons',
           orig %in% c('verbfreq','auxverbfreq','pastfreq','presentfreq','futurefreq')
           ~ 'verbs',
           orig %in% c('articlefreq','adverbfreq','prepsfreq','conjfreq','negatefreq','quantfreq','numberfreq','swearfreq','functfreq')
           ~ 'otherfunctional',
           orig %in% c('socialfreq','familyfreq','friendfreq','humansfreq')
           ~ 'people',
           orig %in% c('affectfreq','posemofreq','negemofreq','anxfreq','angerfreq','sadfreq')
           ~ 'feelings',
           orig %in% c('cogmechfreq','insightfreq','causefreq','discrepfreq','tentatfreq','certainfreq','inhibfreq','inclfreq','exclfreq')
           ~ 'unlabeled',
           orig %in% c('perceptfreq','seefreq','hearfreq','feelfreq')
           ~ 'sense',
           orig %in% c('biofreq','bodyfreq','healthfreq','sexualfreq','ingestfreq')
           ~ 'bio',
           orig %in% c('relativfreq','motionfreq','spacefreq','timefreq')
           ~ 'physics',
           orig %in% c('workfreq','achievefreq','leisurefreq','homefreq','moneyfreq','religfreq','deathfreq')
           ~ 'life',
           orig %in% c('assentfreq','nonflfreq','fillerfreq', 'absolutistfreq')
           ~ 'idk'))


ggplot(corlong, aes(x=red_dim, y=orig, fill=correlation))+
  geom_tile()+
  theme(axis.text.x = element_text(angle = 60, hjust = 1))+
  scale_fill_distiller(palette = "PRGn")+
  facet_wrap(~dictcat, scales='free')
  #scale_fill_viridis(option='E') 

workingdf <- corlong %>% 
  filter(red_dim=='d1') %>% 
  mutate(poscor=abs(correlation))


ggplot(workingdf, aes(x=fct_reorder(orig,poscor,.desc = TRUE), y=poscor, fill=dictcat))+
  geom_col()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

workingdf <- corlong %>% 
      filter(red_dim=='d1') %>% 
      mutate(poscor=abs(correlation), sign=case_when(correlation>=0~'pos', correlation<0~'neg'))
    

```


```{r}

pcs <- distinct(corlong['red_dim'])

ui <- fluidPage(
  titlePanel("PCA Correlations"),
  sidebarLayout(
    sidebarPanel(
      selectInput(inputId = "pc",
                  label = "Principle Component/New Dimemsion",
                  choices=pcs,
                  selected='d1')
      ),
    # Main panel for displaying outputs ----
    mainPanel(

      # Output: Histogram ----
      plotOutput(outputId = "corPlot")
    )
  )
)

server <- function(input, output) {
  output$corPlot <- renderPlot({
    workingdf <- corlong %>% 
      filter(red_dim==input$pc) %>% 
      mutate(poscor=abs(correlation), sign=case_when(correlation>=0~'pos', correlation<0~'neg'))
    
    ggplot(workingdf, aes(x=fct_reorder(orig,poscor,.desc = TRUE), y=poscor, color=sign))+
      geom_col()+
      theme(axis.text.x = element_text(angle = 90, hjust = 1))
  })

}

shinyApp(ui = ui, server = server)
```


